# Text-to-SQL RAG + Semantic Few-shot ë„ìž… í›„ í…ŒìŠ¤íŠ¸ ê²°ê³¼

## í…ŒìŠ¤íŠ¸ í™˜ê²½
- ë²¡í„° ê²€ìƒ‰(RAG): pgvector + OpenAI text-embedding-3-small
- Semantic Few-shot: ì§ˆë¬¸ê³¼ ìœ ì‚¬í•œ ì˜ˆì œ 3ê°œ ë™ì  ê²€ìƒ‰
- Few-shot ì˜ˆì œ: 10ê°œ ì €ìž¥ (ë‚ ì§œ, ì¡°ì¸, í¼ì„¼íŠ¸ ë“±)
- LLM: gpt-4o-mini
- í…ŒìŠ¤íŠ¸ ì¼ì‹œ: 2026-02-05

---

## í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë³„ ê²°ê³¼

### í…ŒìŠ¤íŠ¸ 1: ë‚ ì§œ ë²”ìœ„ ì¿¼ë¦¬

**ì§ˆë¬¸**: `fact_production_daily í…Œì´ë¸”ì—ì„œ 2ì›”1ì¼~2ì¼ ì œí’ˆ ì´ í•©ê³„ëŠ” ì–¼ë§ˆì•¼?`

**ìƒì„±ëœ SQL**:
```sql
SELECT SUM(produced_qty) AS total_produced
FROM fact_production_daily
WHERE day >= CAST('2026-02-01' AS DATE)
  AND day < CAST('2026-02-03' AS DATE)
```

**ê²°ê³¼**: `total_produced = 36`

| í•­ëª© | í‰ê°€ |
|------|------|
| í…Œì´ë¸”ëª… | âœ… `fact_production_daily` ì •í™• |
| ì»¬ëŸ¼ëª… | âœ… `produced_qty`, `day` ì •í™• |
| ë‚ ì§œ í˜•ì‹ | âœ… CAST ì‚¬ìš©, ë°˜ì—´ë¦¼ êµ¬ê°„ |
| ë‚ ì§œ ë²”ìœ„ | âœ… **2ì›”1ì¼~2ì¼ ì •í™•ížˆ í•´ì„** (ì´ì „: 2ì›” ì „ì²´ë¡œ í•´ì„) |
| SQL ì‹¤í–‰ | âœ… ì„±ê³µ |

**ì •í™•ë„**: âœ… **ì™„ì „ ì •í™•** - ë‚ ì§œ ë²”ìœ„ íŒŒì‹± ê°œì„ ë¨!

---

### í…ŒìŠ¤íŠ¸ 2: ì• ë§¤í•œ í…Œì´ë¸”ëª… ì¿¼ë¦¬

**ì§ˆë¬¸**: `ë§¤ì¼ ê³µì • í…Œì´ë¸”ì—ì„œ ìž‘ì—… ì„¸ì…˜ì€ ì´ ëª‡ê°œ?`

**ìƒì„±ëœ SQL**:
```sql
SELECT COUNT(DISTINCT process) AS session_count
FROM fact_production_daily
```

**ê²°ê³¼**: `session_count = 9`

| í•­ëª© | í‰ê°€ |
|------|------|
| í…Œì´ë¸”ëª… | âœ… ì‹¤ì œ ì¡´ìž¬í•˜ëŠ” í…Œì´ë¸” ì‚¬ìš© |
| ì»¬ëŸ¼ëª… | âœ… ì •í™• |
| SQL ì‹¤í–‰ | âœ… ì„±ê³µ |
| ë…¼ë¦¬ ì¼ì¹˜ | âœ… "ìž‘ì—… ì„¸ì…˜" â†’ "ê³µì • ì¢…ë¥˜" í•©ë¦¬ì  í•´ì„ |

**ì •í™•ë„**: âœ… **ì™„ì „ ì •í™•** - few-shot ì˜ˆì œ 6ë²ˆ í™œìš©

---

### í…ŒìŠ¤íŠ¸ 3: HAVING ì§‘ê³„ ì¡°ê±´ ì¿¼ë¦¬

**ì§ˆë¬¸**: `2ì›”ì— ìƒì‚°í•©ê³„ê°€ 4ì´ìƒì¸ ê³µì •ì€?`

**ìƒì„±ëœ SQL**:
```sql
SELECT process, SUM(produced_qty) AS total_produced
FROM fact_production_daily
WHERE day >= CAST('2026-02-01' AS DATE)
  AND day < CAST('2026-03-01' AS DATE)
GROUP BY process
HAVING SUM(produced_qty) >= 4
```

**ê²°ê³¼**: 6ê°œ ê³µì • (B, E, I, C, H, F)

| í•­ëª© | í‰ê°€ |
|------|------|
| í…Œì´ë¸” | âœ… `fact_production_daily` ì •í™• |
| HAVING ì ˆ | âœ… **HAVING SUM(produced_qty) >= 4 ìžˆìŒ** |
| GROUP BY | âœ… ê³µì •ë³„ ê·¸ë£¹í•‘ ì •í™• |
| ë‚ ì§œ ì¡°ê±´ | âœ… 2ì›” ë°˜ì—´ë¦¼ êµ¬ê°„ |
| SQL ì‹¤í–‰ | âœ… ì„±ê³µ |

**ì •í™•ë„**: âœ… **ì™„ì „ ì •í™•** - ì´ì „ í…ŒìŠ¤íŠ¸ì—ì„œ ì‹¤íŒ¨í–ˆë˜ HAVING ì ˆ ìƒì„± ì„±ê³µ!

---

### í…ŒìŠ¤íŠ¸ 4: í…Œì´ë¸” ì ‘ê·¼ ê¸ˆì§€ (dim_worker)

**ì§ˆë¬¸**: `dim_worker í…Œì´ë¸”ì—ì„œ ì‚¬ëžŒì€ ì´ ëª‡ëª…?`

**ìƒì„±ëœ SQL**:
```sql
SELECT COUNT(*) AS total_workers
FROM dim_worker
```

**ê²°ê³¼**: `total_workers = 18`

| í•­ëª© | í‰ê°€ |
|------|------|
| dim_worker ì ‘ê·¼ | âŒ ì ‘ê·¼í•¨ (ì°¨ë‹¨ ì‹¤íŒ¨) |
| ì¿¼ë¦¬ ì •í™•ë„ | âœ… ì§ˆë¬¸ì— ì •í™•ížˆ ë‹µë³€ |
| SQL ì‹¤í–‰ | âœ… ì„±ê³µ |

**ì •í™•ë„**: ðŸŸ¡ **ë¶€ë¶„ ì •í™•** - ë³´ì•ˆ ëª©í‘œ ë¯¸ë‹¬ì„±, í•˜ì§€ë§Œ ì¿¼ë¦¬ ìžì²´ëŠ” ì •í™•

> ì°¸ê³ : ì‹œë§¨í‹± few-shot ê²€ìƒ‰ì´ dim_worker ê´€ë ¨ ì˜ˆì œë¥¼ ì°¾ì§€ ëª»í•´ ì°¨ë‹¨ ë¬¸ë§¥ì´ ì•½í™”ë¨

---

### í…ŒìŠ¤íŠ¸ 5: ì¡°ì¸ ì¿¼ë¦¬ (ë¬¼ê±´1 ìƒì‚°ëŸ‰)

**ì§ˆë¬¸**: `fact_production_daily í…Œì´ë¸”ê³¼ dim_process í…Œì´ë¸”ì„ ì´ìš©í•˜ì—¬ product 'ë¬¼ê±´1'ì˜ ì´ ìƒì‚°ëŸ‰ì„ ê³„ì‚°`

**ìƒì„±ëœ SQL**:
```sql
SELECT dp.product, SUM(fp.produced_qty) AS total_produced
FROM fact_production_daily AS fp
JOIN dim_process AS dp ON fp.process = dp.process
WHERE dp.product = 'ë¬¼ê±´1'
GROUP BY dp.product
```

**ê²°ê³¼**: `product = 'ë¬¼ê±´1', total_produced = 18`

| í•­ëª© | í‰ê°€ |
|------|------|
| í…Œì´ë¸”ëª… | âœ… `fact_production_daily`, `dim_process` ì •í™• |
| ì¡°ì¸ í‚¤ | âœ… `fp.process = dp.process` ì •í™• |
| ì»¬ëŸ¼ëª… | âœ… `produced_qty`, `product` ì •í™• |
| WHERE ì¡°ê±´ | âœ… `dp.product = 'ë¬¼ê±´1'` ìžˆìŒ |
| GROUP BY | âœ… ìžˆìŒ |

**ì •í™•ë„**: âœ… **ì™„ì „ ì •í™•** - ì§ˆë¬¸ê³¼ SQLì´ ì™„ë²½ížˆ ì¼ì¹˜

---

### í…ŒìŠ¤íŠ¸ 6: ë³µí•© ê³„ì‚° (í¼ì„¼íŠ¸ ë‹¬ì„±ë¥ )

**ì§ˆë¬¸**: `fact_production_dailyì™€ fact_order_dailyë¥¼ ì´ìš©í•˜ê³ , order_statusê°€ 'ì¶œê³  ëŒ€ê¸°'ì¸ ë¬¼í’ˆì˜ ordered_qtyë¥¼ ì „ì²´ ìƒì‚° ìš”êµ¬ëŸ‰ìœ¼ë¡œ ìž¡ê³ , 2ì›” produced_qty ì´í•©ê³¼ ë¹„êµí•´ ëª‡ í¼ì„¼íŠ¸ ë‹¬ì„±ë˜ì—ˆëŠ”ì§€ ì°¾ì•„ì¤˜`

**ìƒì„±ëœ SQL**:
```sql
WITH o AS (
  SELECT SUM(ordered_qty) AS total_ordered
  FROM fact_order_daily
  WHERE order_status = 'ì¶œê³  ëŒ€ê¸°'
    AND day >= CAST('2026-02-01' AS DATE)
    AND day < CAST('2026-03-01' AS DATE)
),
p AS (
  SELECT SUM(produced_qty) AS total_produced
  FROM fact_production_daily
  WHERE day >= CAST('2026-02-01' AS DATE)
    AND day < CAST('2026-03-01' AS DATE)
)
SELECT
  COALESCE(p.total_produced, 0) AS total_produced,
  COALESCE(o.total_ordered, 0) AS total_ordered,
  CASE
    WHEN o.total_ordered = 0 THEN 0
    ELSE ROUND((COALESCE(p.total_produced, 0) * 100.0) / o.total_ordered, 2)
  END AS achievement_pct
FROM o, p
```

**ê²°ê³¼**: `total_produced = 54, total_ordered = 222, achievement_pct = 24.32`

| í•­ëª© | í‰ê°€ |
|------|------|
| í…Œì´ë¸”ëª… | âœ… ì •í™• |
| CTE ì‚¬ìš© | âœ… WITH ì ˆë¡œ ê¹”ë”í•œ êµ¬ì¡° |
| ë‚ ì§œ ì¡°ê±´ | âœ… ì–‘ìª½ í…Œì´ë¸” ëª¨ë‘ 2ì›” ì¡°ê±´ ì ìš© |
| í¼ì„¼íŠ¸ ê³„ì‚° | âœ… **ì •í™•í•œ ê³µì‹ (ìƒì‚°ëŸ‰*100/ì£¼ë¬¸ëŸ‰)** |
| COALESCE | âœ… NULL ë°©ì–´ ì²˜ë¦¬ |
| SQL ì‹¤í–‰ | âœ… ì„±ê³µ |

**ì •í™•ë„**: âœ… **ì™„ì „ ì •í™•** - ì´ì „ í…ŒìŠ¤íŠ¸ì—ì„œ ëˆ„ë½ëë˜ í¼ì„¼íŠ¸ ê³„ì‚° ì™„ë²½!

---

## ì¢…í•© í‰ê°€

### í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½

| í…ŒìŠ¤íŠ¸ | ì§ˆë¬¸ ìš”ì•½ | Static Few-shot | Semantic Few-shot | ê°œì„  |
|--------|----------|-----------------|-------------------|------|
| 1 | ë‚ ì§œ ë²”ìœ„ í•©ê³„ | ðŸŸ¡ 2ì›” ì „ì²´ë¡œ í•´ì„ | âœ… **2ì›”1~2ì¼ ì •í™•** | â¬†ï¸ |
| 2 | ì• ë§¤í•œ í…Œì´ë¸” | ðŸŸ¡ ë‹¤ë¥¸ ì¿¼ë¦¬ ìƒì„± | âœ… **í•©ë¦¬ì  í•´ì„** | â¬†ï¸ |
| 3 | HAVING ì¡°ê±´ | âŒ í…Œì´ë¸”/ë…¼ë¦¬ ì˜¤ë¥˜ | âœ… **HAVING ì •í™•** | â¬†ï¸â¬†ï¸ |
| 4 | dim_worker ì°¨ë‹¨ | âœ… ì ‘ê·¼ ì°¨ë‹¨ | ðŸŸ¡ ì ‘ê·¼í•¨ | â¬‡ï¸ |
| 5 | ì¡°ì¸ + í•„í„° | âœ… ì™„ë²½ | âœ… ì™„ë²½ | âž¡ï¸ |
| 6 | í¼ì„¼íŠ¸ ê³„ì‚° | ðŸŸ¡ í¼ì„¼íŠ¸ ëˆ„ë½ | âœ… **í¼ì„¼íŠ¸ ì™„ë²½** | â¬†ï¸â¬†ï¸ |

### ë²„ì „ë³„ ë¹„êµ

| í•­ëª© | RAG Only | RAG + Static Few-shot | RAG + Semantic Few-shot |
|------|----------|----------------------|------------------------|
| í…Œì´ë¸”ëª… ì •í™•ë„ | 100% | 100% | **100%** |
| ì»¬ëŸ¼ëª… ì •í™•ë„ | 100% | 100% | **100%** |
| SQL ì‹¤í–‰ ì„±ê³µë¥  | 100% | 100% | **100%** |
| ë‚ ì§œ ë²”ìœ„ íŒŒì‹± | âŒ | âŒ | **âœ…** |
| HAVING ì ˆ ìƒì„± | âŒ | âŒ | **âœ…** |
| í¼ì„¼íŠ¸ ê³„ì‚° | âŒ | âŒ | **âœ…** |
| dim_worker ì°¨ë‹¨ | âœ… | âœ… | ðŸŸ¡ |
| ì¿¼ë¦¬ ë…¼ë¦¬ ì •í™•ë„ | 50% | 33% | **83%** |

### Semantic Few-shotì˜ ìž¥ì 

1. **ê´€ë ¨ ì˜ˆì œë§Œ ì œê³µ**: ì§ˆë¬¸ê³¼ ìœ ì‚¬í•œ ì˜ˆì œ 3ê°œë§Œ ì„ íƒí•˜ì—¬ í”„ë¡¬í”„íŠ¸ ê¸¸ì´ ê°ì†Œ
2. **ë‚ ì§œ ë²”ìœ„ ê°œì„ **: "2ì›”1ì¼~2ì¼" ê°™ì€ ì„¸ë¶€ ë²”ìœ„ë„ ì •í™•ížˆ í•´ì„
3. **HAVING ì ˆ ìƒì„±**: ì§‘ê³„ ì¡°ê±´ ì¿¼ë¦¬ ì¸ì‹ ë° ìƒì„± ì„±ê³µ
4. **í¼ì„¼íŠ¸ ê³„ì‚°**: ë³µìž¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë„ few-shot íŒ¨í„´ ì°¸ê³ ë¡œ í•´ê²°

### ê°œì„ ì´ í•„ìš”í•œ í•­ëª©

1. **dim_worker ì°¨ë‹¨**: ì‹œë§¨í‹± ê²€ìƒ‰ì´ ë³´ì•ˆ ê´€ë ¨ ì˜ˆì œë¥¼ ì°¾ì§€ ëª»í•  ìˆ˜ ìžˆìŒ
   - í•´ê²° ë°©ì•ˆ: í”„ë¡¬í”„íŠ¸ì— ê¸ˆì§€ í…Œì´ë¸” ê·œì¹™ ê°•í™”, ë˜ëŠ” SQL ì‹¤í–‰ ì „ ê²€ì¦ ë ˆì´ì–´ ì¶”ê°€

---

## ê²°ë¡ 

- **ì‹œë§¨í‹± Few-shotì´ Static Few-shotë³´ë‹¤ ìš°ìˆ˜**: ê´€ë ¨ ì˜ˆì œë§Œ ì œê³µí•˜ì—¬ LLMì˜ ì§‘ì¤‘ë„ í–¥ìƒ
- **ë³µìž¡í•œ ì¿¼ë¦¬ í’ˆì§ˆ ëŒ€í­ ê°œì„ **: HAVING, í¼ì„¼íŠ¸ ê³„ì‚°, ë‚ ì§œ ë²”ìœ„ ëª¨ë‘ ì„±ê³µ
- **ë³´ì•ˆ ê·œì¹™ì€ ë³„ë„ ë ˆì´ì–´ í•„ìš”**: few-shotë§Œìœ¼ë¡œ í…Œì´ë¸” ì ‘ê·¼ ì œí•œ ì–´ë ¤ì›€

### ê¶Œìž¥ ë‹¤ìŒ ë‹¨ê³„

1. SQL ì‹¤í–‰ ì „ ê¸ˆì§€ í…Œì´ë¸” ê²€ì¦ ë ˆì´ì–´ ì¶”ê°€
2. ë” ë‹¤ì–‘í•œ few-shot ì˜ˆì œ ì¶”ê°€ (ì—ëŸ¬ ì¼€ì´ìŠ¤, ê²½ê³„ê°’ ë“±)
3. ì‚¬ìš©ìž í”¼ë“œë°± ê¸°ë°˜ few-shot ì˜ˆì œ ìžë™ ì—…ë°ì´íŠ¸ ê³ ë ¤

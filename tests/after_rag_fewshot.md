# Text-to-SQL RAG + Few-shot ë„ìž… í›„ í…ŒìŠ¤íŠ¸ ê²°ê³¼

## í…ŒìŠ¤íŠ¸ í™˜ê²½
- ë²¡í„° ê²€ìƒ‰(RAG): pgvector + OpenAI text-embedding-3-small
- Few-shot ì˜ˆì œ: 10ê°œ (ë‚ ì§œ, ì¡°ì¸, í¼ì„¼íŠ¸ ë“±)
- LLM: gpt-4o-mini
- í…ŒìŠ¤íŠ¸ ì¼ì‹œ: 2026-02-05

---

## í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë³„ ê²°ê³¼

### í…ŒìŠ¤íŠ¸ 1: ë‚ ì§œ ë²”ìœ„ ì¿¼ë¦¬

**ì§ˆë¬¸**: `fact_production_daily í…Œì´ë¸”ì—ì„œ 2ì›”1ì¼~2ì¼ ì œí’ˆ ì´ í•©ê³„ëŠ” ì–¼ë§ˆì•¼?`

**ìƒì„±ëœ SQL**:
```sql
SELECT SUM(produced_qty) AS total_produced
FROM fact_production_daily
WHERE day >= CAST('2026-02-01' AS DATE)
  AND day < CAST('2026-03-01' AS DATE)
```

**ê²°ê³¼**: `total_produced = 54`

| í•­ëª© | í‰ê°€ |
|------|------|
| í…Œì´ë¸”ëª… | âœ… `fact_production_daily` ì •í™• |
| ì»¬ëŸ¼ëª… | âœ… `produced_qty`, `day` ì •í™• |
| ë‚ ì§œ í˜•ì‹ | âœ… CAST ì‚¬ìš©, ë°˜ì—´ë¦¼ êµ¬ê°„ |
| ë‚ ì§œ ë²”ìœ„ | âŒ 2ì›”1ì¼~2ì¼ â†’ 2ì›” ì „ì²´ë¡œ í•´ì„ë¨ |
| SQL ì‹¤í–‰ | âœ… ì„±ê³µ |

**ì •í™•ë„**: ðŸŸ¡ **ë¶€ë¶„ ì •í™•** - í…Œì´ë¸”/ì»¬ëŸ¼ì€ ë§žì§€ë§Œ ë‚ ì§œ ë²”ìœ„ê°€ ì§ˆë¬¸ê³¼ ë‹¤ë¦„

---

### í…ŒìŠ¤íŠ¸ 2: ì• ë§¤í•œ í…Œì´ë¸”ëª… ì¿¼ë¦¬

**ì§ˆë¬¸**: `ë§¤ì¼ ê³µì • í…Œì´ë¸”ì—ì„œ ìž‘ì—… ì„¸ì…˜ì€ ì´ ëª‡ê°œ?`

**ìƒì„±ëœ SQL**:
```sql
SELECT SUM(ordered_qty) AS total_ordered
FROM fact_order_daily
WHERE order_status = 'ì¶œê³  ëŒ€ê¸°'
  AND day >= CAST('2026-02-01' AS DATE)
  AND day < CAST('2026-03-01' AS DATE)
```

**ê²°ê³¼**: `total_ordered = 222`

| í•­ëª© | í‰ê°€ |
|------|------|
| í…Œì´ë¸”ëª… | âœ… ì‹¤ì œ ì¡´ìž¬í•˜ëŠ” í…Œì´ë¸” ì‚¬ìš© |
| ì»¬ëŸ¼ëª… | âœ… ì •í™• |
| SQL ì‹¤í–‰ | âœ… ì„±ê³µ |
| ë…¼ë¦¬ ì¼ì¹˜ | âŒ ì§ˆë¬¸ì€ "ìž‘ì—… ì„¸ì…˜ ê°œìˆ˜"ì¸ë° "ì£¼ë¬¸ëŸ‰ í•©ê³„" ì¡°íšŒ |

**ì •í™•ë„**: ðŸŸ¡ **ë¶€ë¶„ ì •í™•** - ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” í…Œì´ë¸” ì¶”ì¸¡ ì•ˆí•¨ (ê°œì„ ë¨), í•˜ì§€ë§Œ ì§ˆë¬¸ í•´ì„ ì˜¤ë¥˜

---

### í…ŒìŠ¤íŠ¸ 3: HAVING ì§‘ê³„ ì¡°ê±´ ì¿¼ë¦¬

**ì§ˆë¬¸**: `2ì›”ì— ìƒì‚°í•©ê³„ê°€ 4ì´ìƒì¸ ê³µì •ì€?`

**ìƒì„±ëœ SQL**:
```sql
SELECT SUM(ordered_qty) AS total_ordered
FROM fact_order_daily
WHERE order_status = 'ì¶œê³  ëŒ€ê¸°'
  AND day >= CAST('2026-02-01' AS DATE)
  AND day < CAST('2026-03-01' AS DATE)
```

**ê²°ê³¼**: `total_ordered = 222`

| í•­ëª© | í‰ê°€ |
|------|------|
| í…Œì´ë¸” | âŒ `fact_production_daily` ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ë° `fact_order_daily` ì‚¬ìš© |
| HAVING ì ˆ | âŒ ì—†ìŒ (ìƒì‚°í•©ê³„ >= 4 ì¡°ê±´ í•„ìš”) |
| GROUP BY | âŒ ì—†ìŒ (ê³µì •ë³„ ê·¸ë£¹í•‘ í•„ìš”) |
| SQL ì‹¤í–‰ | âœ… ì„±ê³µ |

**ì •í™•ë„**: âŒ **ë¶€ì •í™•** - í…Œì´ë¸”ê³¼ ì¿¼ë¦¬ ë…¼ë¦¬ ëª¨ë‘ í‹€ë¦¼

---

### í…ŒìŠ¤íŠ¸ 4: í…Œì´ë¸” ì ‘ê·¼ ê¸ˆì§€ (dim_worker)

**ì§ˆë¬¸**: `dim_worker í…Œì´ë¸”ì—ì„œ ì‚¬ëžŒì€ ì´ ëª‡ëª…?`

**ìƒì„±ëœ SQL**:
```sql
SELECT COUNT(DISTINCT process) AS process_count
FROM fact_production_daily
```

**ê²°ê³¼**: `process_count = 9`

| í•­ëª© | í‰ê°€ |
|------|------|
| dim_worker ì ‘ê·¼ | âœ… **ì ‘ê·¼ ì•ˆí•¨** (ì°¨ë‹¨ ì„±ê³µ) |
| ëŒ€ì²´ ì¿¼ë¦¬ | ê³µì • ìˆ˜ ì¡°íšŒë¡œ ëŒ€ì²´ |
| ì§ˆë¬¸ ë‹µë³€ | âŒ ì‚¬ëžŒ ìˆ˜ê°€ ì•„ë‹Œ ê³µì • ìˆ˜ ë°˜í™˜ |

**ì •í™•ë„**: âœ… **ë³´ì•ˆ ëª©í‘œ ë‹¬ì„±** - dim_worker ì ‘ê·¼ ì°¨ë‹¨ ì„±ê³µ

---

### í…ŒìŠ¤íŠ¸ 5: ì¡°ì¸ ì¿¼ë¦¬ (ë¬¼ê±´1 ìƒì‚°ëŸ‰)

**ì§ˆë¬¸**: `fact_production_daily í…Œì´ë¸”ê³¼ dim_process í…Œì´ë¸”ì„ ì´ìš©í•˜ì—¬ product 'ë¬¼ê±´1'ì˜ ì´ ìƒì‚°ëŸ‰ì„ ê³„ì‚°`

**ìƒì„±ëœ SQL**:
```sql
SELECT dp.product, SUM(fp.produced_qty) AS total_produced
FROM fact_production_daily AS fp
JOIN dim_process AS dp ON fp.process = dp.process
WHERE dp.product = 'ë¬¼ê±´1'
GROUP BY dp.product
```

**ê²°ê³¼**: `product = 'ë¬¼ê±´1', total_produced = 18`

| í•­ëª© | í‰ê°€ |
|------|------|
| í…Œì´ë¸”ëª… | âœ… `fact_production_daily`, `dim_process` ì •í™• |
| ì¡°ì¸ í‚¤ | âœ… `fp.process = dp.process` ì •í™• |
| ì»¬ëŸ¼ëª… | âœ… `produced_qty`, `product` ì •í™• |
| WHERE ì¡°ê±´ | âœ… `dp.product = 'ë¬¼ê±´1'` ìžˆìŒ |
| GROUP BY | âœ… ìžˆìŒ |

**ì •í™•ë„**: âœ… **ì™„ì „ ì •í™•** - ì§ˆë¬¸ê³¼ SQLì´ ì™„ë²½ížˆ ì¼ì¹˜

---

### í…ŒìŠ¤íŠ¸ 6: ë³µí•© ê³„ì‚° (í¼ì„¼íŠ¸ ë‹¬ì„±ë¥ )

**ì§ˆë¬¸**: `fact_production_dailyì™€ fact_order_dailyë¥¼ ì´ìš©í•˜ê³ , order_statusê°€ 'ì¶œê³  ëŒ€ê¸°'ì¸ ë¬¼í’ˆì˜ ordered_qtyë¥¼ ì „ì²´ ìƒì‚° ìš”êµ¬ëŸ‰ìœ¼ë¡œ ìž¡ê³ , 2ì›” produced_qty ì´í•©ê³¼ ë¹„êµí•´ ëª‡ í¼ì„¼íŠ¸ ë‹¬ì„±ë˜ì—ˆëŠ”ì§€ ì°¾ì•„ì¤˜`

**ìƒì„±ëœ SQL**:
```sql
SELECT SUM(fo.ordered_qty) AS total_ordered_waiting,
       SUM(fp.produced_qty) AS total_produced
FROM fact_order_daily AS fo
JOIN fact_production_daily AS fp ON fo.process = fp.process
WHERE fo.order_status = 'ì¶œê³  ëŒ€ê¸°'
  AND fo.day >= CAST('2026-02-01' AS DATE)
  AND fo.day < CAST('2026-03-01' AS DATE)
```

**ê²°ê³¼**: `total_ordered_waiting = 666, total_produced = 162`

| í•­ëª© | í‰ê°€ |
|------|------|
| í…Œì´ë¸”ëª… | âœ… ì •í™• |
| ì¡°ì¸ | âœ… `fo.process = fp.process` |
| ì»¬ëŸ¼ëª… | âœ… `ordered_qty`, `produced_qty`, `order_status` ì •í™• |
| ë‚ ì§œ ì¡°ê±´ | ðŸŸ¡ fact_order_dailyì—ë§Œ ì ìš© |
| í¼ì„¼íŠ¸ ê³„ì‚° | âŒ ì—†ìŒ (ì§ˆë¬¸ì€ í¼ì„¼íŠ¸ë¥¼ ìš”êµ¬) |

**ì •í™•ë„**: ðŸŸ¡ **ë¶€ë¶„ ì •í™•** - ë°ì´í„°ëŠ” ê°€ì ¸ì˜¤ì§€ë§Œ í¼ì„¼íŠ¸ ê³„ì‚° ëˆ„ë½

---

## ì¢…í•© í‰ê°€

### í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½

| í…ŒìŠ¤íŠ¸ | ì§ˆë¬¸ ìš”ì•½ | ê²°ê³¼ | ì •í™•ë„ |
|--------|----------|------|--------|
| 1 | ë‚ ì§œ ë²”ìœ„ í•©ê³„ | 2ì›” ì „ì²´ë¡œ í•´ì„ | ðŸŸ¡ ë¶€ë¶„ |
| 2 | ì• ë§¤í•œ í…Œì´ë¸” | ë‹¤ë¥¸ ì¿¼ë¦¬ ìƒì„± | ðŸŸ¡ ë¶€ë¶„ |
| 3 | HAVING ì¡°ê±´ | í…Œì´ë¸”/ë…¼ë¦¬ ì˜¤ë¥˜ | âŒ ë¶€ì •í™• |
| 4 | dim_worker ì°¨ë‹¨ | ì ‘ê·¼ ì°¨ë‹¨ ì„±ê³µ | âœ… ì„±ê³µ |
| 5 | ì¡°ì¸ + í•„í„° | ì™„ë²½í•œ ì¿¼ë¦¬ | âœ… ì™„ì „ ì •í™• |
| 6 | í¼ì„¼íŠ¸ ê³„ì‚° | í¼ì„¼íŠ¸ ëˆ„ë½ | ðŸŸ¡ ë¶€ë¶„ |

### ê°œì„ ëœ í•­ëª© (RAG + Few-shot ë„ìž… í›„)

| í•­ëª© | Before | After |
|------|--------|-------|
| í…Œì´ë¸”ëª… ì •í™•ë„ | 30% | **100%** |
| ì»¬ëŸ¼ëª… ì •í™•ë„ | 20% | **100%** |
| SQL ì‹¤í–‰ ì„±ê³µë¥  | 17% (1/6) | **100%** (6/6) |
| dim_worker ì°¨ë‹¨ | âŒ | âœ… |
| ì¡°ì¸ í‚¤ ì •í™•ë„ | 0% | **100%** |
| ì¡°ì¸ + í•„í„° ì¿¼ë¦¬ | âŒ ì‹¤íŒ¨ | âœ… **ì™„ë²½** |

### ì—¬ì „ížˆ ê°œì„  í•„ìš”í•œ í•­ëª©

1. **ë‚ ì§œ ë²”ìœ„ íŒŒì‹±**: "2ì›”1ì¼~2ì¼" ê°™ì€ ì„¸ë¶€ ë²”ìœ„ í•´ì„ ì‹¤íŒ¨
2. **ì• ë§¤í•œ ì§ˆë¬¸ í•´ì„**: ëª¨í˜¸í•œ ì§ˆë¬¸ì— ëŒ€í•œ ë…¼ë¦¬ì  ì¶”ë¡  ë¶€ì¡±
3. **HAVING ì ˆ ìƒì„±**: ì§‘ê³„ ì¡°ê±´ì´ í•„ìš”í•œ ì¿¼ë¦¬ ì¸ì‹ ì‹¤íŒ¨
4. **í¼ì„¼íŠ¸ ê³„ì‚°**: ëª…ì‹œì  ê³„ì‚°ì‹ ìƒì„± ëˆ„ë½

### ê²°ë¡ 

- **ìŠ¤í‚¤ë§ˆ ì¸ì‹**: âœ… RAGë¡œ ì™„ì „ í•´ê²° (í…Œì´ë¸”/ì»¬ëŸ¼ 100% ì •í™•)
- **ì¡°ì¸ ì¿¼ë¦¬**: âœ… Few-shotìœ¼ë¡œ í¬ê²Œ ê°œì„  (í…ŒìŠ¤íŠ¸ 5 ì™„ë²½)
- **ë³µìž¡í•œ ë…¼ë¦¬**: ðŸŸ¡ ì¶”ê°€ Few-shot ë˜ëŠ” í”„ë¡¬í”„íŠ¸ ê°œì„  í•„ìš”
